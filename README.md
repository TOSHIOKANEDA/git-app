#Test-laneの仕様（Crutial Part）:

##ユーザーについてのデータ:
- ユーザー登録が正しければ、予約権を管理者が付与できる
- 予約権は将来の拡張性を考慮し、何タイプも増やすことができる。（想定：VIPが５、Testが４、管理者が１・・・）
- 管理者はユーザー登録を抹消することができる
- メール機能は付属していないので、忘れた場合などは再登録（PasswordはDB上tokenで保持しているの、管理者でもわからない設定）
- ”１運輸事業許可証番号、１user制度”を考慮し、運輸事業許可証番号についてはuniqをtrueにてカラムを追加している
- defaultでpower_idを１とし、powerは初期設定ではONの状態にしている
- power_idで利用制限をするのではなく、authorityの番号（9）を以って利用制限とした。そのため、edit.htnl.erbにてpower_idを操作する画面は削除した
- ラウンド用としての設定が未設定（usersのeditでラウンド者を設定していない）
- 100件を超えたらユーザー新規登録できないようにした
- 仕様書及び申請書をLoginページに貼り付けて、使い方を確認できるようにしたい


##予約枠についてのデータ:
- 予約枠があるだけ入る
- 予約枠がなければNoticeが現れて、予約できない
- 予約がUpdateできるのは、Loginしているアカウントの所持しているBooking分だけ。
- 予約枠は管理者でのみ登録することができる
- １営業日前からのみ予約開始可能とのことで、Slotは予約日１日が完了したら、管理者が過去のSlotを削除し、翌日以降のSlotを設定することを想定している
- 予約枠は、日にち/時間別で管理することができる
- 予約枠設定時のバリデーションは、翌日以降から５日間のみで設定できるようにした
- slotにslot_statusを追加し、slot_statusをeditからupdateできるようにした。
- slotが2の分については、予約一覧から更新できないよう設定した
- slotが2の分については、slotがDBに存在していても、選択肢に入ってこないように設定した

##予約それ自体についてのデータ:
- コンテナ番号のvalidationの設定を行った（大文字の半角が前半４文字、後半数字が半角で７文字にてDB登録可）
- 予約一覧からコンテナ番号とトラック番号のUpdateを行えて、確定画面を表示させることができる
- Bookingは現状不要なので削除した
- ユーザーか予約した予約枠が管理者によって削除されたら、予約データも削除されるように設定した
- 予約一覧からの更新を２回のみに制限した
- 予約内容は予約したユーザーも管理者も閲覧することができ、管理者も予約を削除し更新することができる
- csv抽出機能の追加
- 予約コードとしてのpass_codeをランダム自動生成
- トラックナンバーがブランクの場合には、別ビューを表示させる
- 削除前に削除確認のPopup
- 管理者が削除した後にrouting
- 輸出許可の出ている分
- 管理画面のMarkup
- 選択部分を選択必須とした
- current_userがVIPかRoundの場合は、実入り搬入も可能とした。
- 受付再開と停止の機能を追加した。
- VIPとラウンド業者と一般とで、時間枠を振り分けることができるようにした
- 実入り搬入はラウンド用のみとして設定
- 予約内容を当日も確認し、トラック番号だけでも変更できるようにしたい
- ケースによって背景色を赤く変える

##広告内容についてのデータ:
- Noticeの掲示板を作成

##enumの説明
-(1) authority: 1 = 管理者、2 = VIP(Power offでもBookingが
可能)、3 = ラウンド用、4 = 一般
-(2) allowance: Max２回
-(3) purpose: 1 = 実入り搬出、2 = 大井５号空バンPICK(users/show.html.erbにて三項演算子使用につき注意)、3 = 実入り搬入、4 = 新大井バンプール空バンPICK、5 = 新大井空バンPICK
-(4) vip: 1 = VIP、2 = 一般
-(5) slot_status: 1 = 表示させる、2 = 表示させない
-(6) full_status: 1 = 余裕ある、2 = Full book

##未導入の機能
- URLの設定

---
Version 1.0.1
- 管理者が予約を削除することができるようになった
- 管理者だけが、ユーザーを削除することができるようになった
- すでに別予約でコンテナの登録があった場合には、予約ができない
- 退職の場合などを考えて、名前や電話番号を変更できる機能を加える
- インデックスの名前を会社名に変更
- トラック業者さんの名前、メールアドレス、電話番号の変更を自分で行えるようにする
- 新規登録者を受け付けた際の手順を、管理者のEDITにて記載

Version 1.0.2
- 管理者が予約一覧を確認することができる
- 利用者の名前をuserテーブルではなく、orderテーブルから引っ張ってくるようにした

Version 1.0.3
- 管理画面のhtml整備　https://gyazo.com/78470976d0a6d28107ee88999c244374
- 管理者画面から、管理者自身を削除することができないようにコントローラー側を記述した
- 現在の予約台数を確認できるようにした（詳細設定別途）
- 予約でいっぱいの時には、予約の選択肢に現れない
- 予約いっぱいになった枠の表記

Version 1.0.4
- mailerの実装。管理者よりキャンセルとなった場合には登録したメールアドレスより自動配信

Version 1.0.5
- パスワード忘れでメールを飛んで来る

Version 1.0.6
- 輸出搬入分のみ、complete画面での日付を搬入日当日にした（ラウンドユーザーは搬入日当日に画面抽出を促す）。また、時間帯も適当に選択してもらい、結果的に9時から15:30までという流れにした。つまりDB上の時間帯と実際の搬入時間は異なることになる。予約が増えたら、別途09:00~15:30の輸出枠を毎日設定してもらう。
- pagenateのview変更

Version 1.0.7
- トラック番号をサインインせずにUpdateし、Orderと紐付けている
- Order DBをサインインなしでUpdateさせたくないので、CSVにはトラック番号を含まない

Version 1.1.0
- Booking番号カラム追加。cntr同様にnil falseにする。
- 空Pick時は、"DUMY0000000"の番号をcntrに食わせてvalidationを通過
- Booking番号カラム追加。cntr同様にnil falseにする。
- 実入りPick時は、booking番号に"dummy"の番号をbookingに食わせてvalidationを通過
- purposeが1（実入り搬出）でcntrが空欄の時だけvalidationがきくようにする
- purposeが2（空Pick）でbookingが空欄の時だけvalidationがきくようにする
- ログイン後にpurposeが1か2かの選択をさせる画面に移行
- １なら実入り搬出、2なら空pick
- トラック番号登録時も空ピックか実入り搬出か選ばせる
- Booking番号と合言葉で照合

Version 1.1.1
- Mytruckの管理
- スロット内に、現状の本数がわかるようにする
- 一括と搬出要件の削除

Version 1.1.2
- User情報のダウンロードボタンの設置
- VIPが使用できる（Powerがoffでも予約が可能、トラック登録も可能）
- 削除したスロットの数をカウントさせてメール上のTotalにだす
- Validationの設定
 (1)Orderの訂正・削除・登録が可能 -done
 (2)Orderは同一スロットで同じコンテナ番号は登録できない -done
 (3)TruckはOrderで訂正したコンテナ番号も反映させることができる -done
 (4)Truckは複数のOrder_idで登録できない -done
 (5)Truckの訂正・削除・登録が可能 -done
 (6)Slot destroyのメーラー、コメントアウト削除

Version 1.1.3
- 訂正時すでに存在しているコンテナも登録できてしまう（同じSlot_id）



##production環境
今後deploy時に発生し得るエラー。config.public_file_server.enabledをtrueに変更してみる。
http://blog.atwata.com/middle/2017/09/30/rails5-nginx-puma.html

##注意点
master.keyの生成を行いcredentials.yml.encを削除した
https://qiita.com/kenzoukenzou104809/items/67ac14d1c89f7c5641c1